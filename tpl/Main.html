[bodyEntry: Body_Entry $body]
	{if $body.type == Body_EntryType_Paragraph}
		<p>
			{for $item in $body.items}
				{block bodyItem $item}
			{end}
		</p>
	{else $body.type == Body_EntryType_Block}
		{if $body.u.block == Body_BlockType_Note}
			<p class="note">
		{else}
			<p class="warning">
		{end}
			{for $block in $body.items}
				{block bodyItem $block}
			{end}
		</p>
	{else $body.type == Body_EntryType_List}
		<ul>
			{for $item in $body.u.list}
				<li>{for $block in $item.items}{block bodyItem $block}{end}</li>
			{end}
		</ul>
	{else $body.type == Body_EntryType_Items}
		{for $item in $body.items}
			{block bodyItem $item}
		{end}
	{end}
[end]

[bodyItem: Body_Item $body]
	{if $body.type == Body_ItemType_Text}
		{pass TemplateHelper_PrintStyled $body.u.text.style, $body.u.text.value}
	{else $body.type == Body_ItemType_Command}
		<script type="syntaxhighlighter" class="brush: shell"><!\[CDATA\[{$body.u.cmd.value}]]></script>
	{else $body.type == Body_ItemType_Code}
		<script type="syntaxhighlighter" class="brush: c"><!\[CDATA\[{$body.u.code.value}]]></script>
	{else $body.type == Body_ItemType_Mail}
		<a href="mailto:{$body.u.mail.addr}">{$body.u.mail.caption}</a>
	{else $body.type == Body_ItemType_Anchor}
		<a name="{$body.u.anchor.name}"></a>
	{else $body.type == Body_ItemType_Jump}
		<a href="#{$body.u.jump.anchor}">{$body.u.jump.caption}</a>
	{else $body.type == Body_ItemType_Url}
		<a href="{$body.u.url.url}">{$body.u.url.caption}</a>
	{end}
[end]

<head>
	<title>{#doc->title}</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	<script type="text/javascript" src="{#base}/syntaxhighlighter/scripts/XRegExp.js"></script>
	<script type="text/javascript" src="{#base}/syntaxhighlighter/scripts/shCore.js"></script>
	<script type="text/javascript" src="{#base}/syntaxhighlighter/scripts/shBrushCpp.js"></script>
	<script type="text/javascript" src="{#base}/syntaxhighlighter/scripts/shBrushBash.js"></script>

	<link href="{#base}/syntaxhighlighter/styles/shCore.css"         rel="stylesheet" type="text/css" />
	<link href="{#base}/syntaxhighlighter/styles/shThemeDefault.css" rel="stylesheet" type="text/css" />

	<script type="text/javascript">
		 SyntaxHighlighter.all()
	</script>

	<link href="{#base}/style.css" rel="stylesheet" type="text/css" />
</head>

<body>
	<h1>{#doc->title}</h1>

	<h2><a href="#toc" name="toc">Table of Contents</a></h2>
	<ul>
		{for $chapter in #doc->chapters}
			<li><a href="#{$chapter->title}">{$chapter->title}</a><br /></li>
		{end}
	</ul>

	{for $chapter in #doc->chapters}
		<h2><a href="#{$chapter->title}" name="{$chapter->title}">{$chapter->title}</a></h2>

		{for $body in $chapter->body.items}
			{block bodyEntry $body}
		{end}

		{for $section in $chapter->sections}
			<h3>{pass html $section->title}</h3>

			{for $body in $section->body.items}
				{block bodyEntry $body}
			{end}
		{end}
	{end}
</body>
